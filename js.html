
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Moip Assinaturas - Documentação online</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Exemplo de utilização do Javascript assinaturas.js">
        <meta name="author" content="Moip Assinaturas">

        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/demo.css" rel="stylesheet">
        <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="css/prettify.css" rel="stylesheet">

        <link rel="shortcut icon" href="img/favicon.ico">
        <style>
            section {
                padding-top: 30px;
            }          
        </style>
    </head>

    <body data-spy="scroll" data-target="#navbar" data-offset="10">
        <div class="navbar navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand active" href="index.html">Assinaturas Docs</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav" role="navigation">
                            <li><a href="index.html">Introdução</a></li>                           
                            <li><a href="comece.html">Comece a integrar</a></li>                           
                            <li class="dropdown active">
                                <a class="dropdown-toggle" id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="api.html">
                                    Documentação
                                    <b class="caret"></b>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="api.html">APIs</a></li>
                                    <li class="active"><a href="js.html">moip-assinaturas.js</a></li>              
                                    <li class="divider"></li>
                                    <li class="nav-header">Adicionais</li>
                                    <li><a href="webhooks.html">Webhooks</a></li>
                                    <li><a href="erros_alertas.html">Erros e Alertas</a></li>              
                                </ul>
                            </li>   
                            <li><a href="producao.html">Homologação</a></li>              
                            <li><a href="ajuda.html">Ajuda</a></li>              
                            <li><a href="english_version.html">English version</a></li>
                        </ul>
                        <a href="http://assinaturas.moip.com.br" class="btn pull-right">Login</a>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>


        <div class="container">

            <!-- Docs nav
            ================================================== -->
            <div class="row">
                <div class="span3 bs-docs-sidebar" id="navbar">
                    <ul class="nav nav-list bs-docs-sidenav affix">
                        <li><a href="#config"><i class="icon-chevron-right"></i> Configurando</a></li>
                        <li><a href="#identification"><i class="icon-chevron-right"></i> Identificação</a></li>
                        <li><a href="#subscribe"><i class="icon-chevron-right"></i> Criar Assinatura</a></li>
                        <li><a href="#customer"><i class="icon-chevron-right"></i> Criar cliente com Cartão</a></li>
                        <li><a href="#update"><i class="icon-chevron-right"></i> Atualizar cartão</a></li>
                        <li><a href="#callback"><i class="icon-chevron-right"></i> Callback</a></li>
                        <li><a href="http://moiplabs.github.com/assinaturas-js-demo/"><i class="icon-chevron-right"></i> Exemplo para Download <i class="icon-download-alt"></i></a></li> 
                    </ul>
                </div>
                <div class="span9" style="margin-top: -40px;">


                    <!-- Apresentação
                    ================================================== -->
                    <div id="apresentacao"></div>
                    <section>
                        <div class="page-header">
                            <h1>JavaScript de Pagamento <small>moip-assinaturas.min.js</small></h1>
                        </div>
                        <p>O <strong>moip-assinaturas.min.js</strong> é uma biblioteca <strong>JavaScript</strong> feita para facilitar a integração 
                            do Moip Assinaturas com o seu site, permitindo o desenvolvimento do seu próprio fluxo 
                            de contratação sem que seu cliente precise sair do seu ambiente, assim 
                            como funciona o Checkout Transparente do Moip. Além de possuir uma estrutura de validações pré-definidas, utilizando essa biblioteca você também reduz o seu escopo para o PCI, uma vez que os dados de cartão de crédito vão direto do navegador do seu cliente para o Moip.</p>
                    </section>

                    <!-- Configurando
                    ================================================== -->
                    <div id="config"></div>
                    <section>
                        <div class="page-header">
                            <h1>Configurando <small>Obrigatório</small></h1>
                        </div>
                        <div>
                            <p>O Moip Assinaturas dispõe de dois ambientes: <span class="label label-info">SANDBOX</span> e <span class="label label-success">PRODUÇÃO</span>, permitindo flexibilidade entre testes de homologação e ambiente real.</p>
                            <div class="input-prepend">
                                <span class="add-on">SANDBOX</span> 
                                <input class="span8" id="prependedInput" type="text" value="https://sandbox.moip.com.br/moip-assinaturas.min.js" />
                            </div>                        
                            <div class="input-prepend">
                                <span class="add-on">PRODUÇÃO</span> 
                                <input class="span8" id="prependedInput" type="text" value="https://api.moip.com.br/moip-assinaturas.min.js" />
                            </div>

                            <div><p>A biblioteca possui dependência do <a href="http://jquery.com">jQuery</a>, portanto, é importande adicioná-la antes de realizar a importação da biblioteca JS do Moip Assianturas</p>
                            <h5>Exemplo:</h5>
                            <pre class="prettyprint linenums">&lt;script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"&gt;&lt;/script&gt;
&lt;script src="https://[sandbox ou api].moip.com.br/moip-assinaturas.min.js" type="text/javascript"&gt;&lt;/script&gt;</pre></div>
                             
                        </div>
                    </section>


                    <!-- Identificação
                    ================================================== -->
                    <div id="identification"></div>
                    <section>
                        <div class="page-header">
                            <h1>Identificação <small>Obrigatório para todos os serviços do moip-assinaturas.min.js</small></h1>
                        </div>
                        <div>
                            <p>Todos os serviços do Moip Assinaturas são autenticados e deve ser informada na hora de instânciar um objeto do tipo <code>MoipAssinaturas()</code>. Sua chave pública é seu <strong>Token</strong> Moip.</p>
                            <p><strong>Exemplo:</strong></p>
                            <pre class="prettyprint linenums">var moip = new MoipAssinaturas("SEU_TOKEN");</pre>

                            <h4>Como conseguir o Token e Key</h4>
                            <p>O Moip assinaturas utiliza os mesmo token e key disponíveis em sua Conta Moip. Assim, não só estamos unificando as chaves, como estamos mantendo integradas as contas do Moip e do Moip Assinaturas.</p>
                            <p>Para obter seu token e key, siga os procedimentos abaixo:</p>
                            <ul>
                                <li>Acesse o <a href="https://www.moip.com.br">moip.com.br</a>;</li>
                                <li>Clique na opção “Ferramentas” no Menu;</li>
                                <li>Selecione a opção “API Moip” e depois “Chaves de Acesso”;</li>
                                <li>Seu TOKEN será exibido na página seguinte, a KEY estará oculta, mas basta clicar no link e ela será exibida na mesma página.</li>
                            </ul>
                        </div>
                    </section>


                    <!-- Criar Assinatura
                    ================================================== -->
                    <div id="subscribe"></div>
                    <section>
                        <div class="page-header">
                            <h1>Criar uma assinatura</h1>
                        </div>
                        <div>
                            <h4>Pré-requisitos</h4>
                            <ul>
                                <li>Criação prévia de um plano. <a href="#">Saiba como criar um plano</a></li>
                                <li>Importação da biblioteca <b>moip-assinaturas.min.js</b>. <a href="#config">Saiba mais</a></li>
                                <li>Possuir <b>TOKEN</b> de identificação. <a href="#identification">Saiba mais</a></li>
                            </ul>
                        </div>
                        <div>
                            <br>
                            <h4>Criando o cliente <small>new Customer()</small></h4>
                            <p>A criação de uma assinatura prevê a existência de um cliente, para criá-lo basta instânciar o objeto 
                                <code>new Customer()</code> conforme <a href="#build_customer">exemplo</a>. 
                                O cliente possui as informações pessoais do assinante (nome, e-mail, código do cliente, cpf, 
                                data de nascimento, etc), o endereço <code>new Address()</code>(rua, numero, bairro, etc) 
                                e o os dados de cobrança <code>new BillingInfo()</code>(cartão de crédito).</p>
                            <br>
                            <h4>Criando a assinatura <small>new MoipAssinaturas()</small></h4>
                            <p>O primeiro passo para a utilização do <strong>moip-assinaturas.min.js</strong> é instanciar o objeto 
                                <code>new MoipAssinaturas('SEU_TOKEN')</code>, essa classe JavaScript é responsável por realizar a 
                                integração com o Moip Assinaturas. Em seu construtor, ela recebe  apenas o seu token de autorização.</p>
                            <p>O metódo <code>MoipAssinaturas.subscribe</code> é responsavel por criar uma nova assinatura com um novo cliente. 
                                Ele recebe como parâmetro um objeto <code>new Subscription()</code> contendo como parâmetros o código da assinatura, 
                                o novo cliente (criado atráves do objeto Customer) e o código do plano.</p>

                            <p>Abaixo há um exemplo de um <code>JavaScript</code> para gerar uma assinatura.</p>
                            <h5>Exemplo</h5>
                            <div>
                                <pre class="prettyprint linenums">
var moip = new MoipAssinaturas("SEU_TOKEN");
var customer = build_customer();
var plan_code = $("#plan_code").val();

moip.subscribe(
    new Subscription()
        .with_code(new Date().getTime())
        .with_new_customer(customer)
        .with_plan_code(plan_code);
).callback(function(response){
    if (response.has_errors()) {
        for (i = 0; i < response.errors.length; i++) {
          var erro = response.errors[i].description;
          $("#erros").append(erro);
        }
        return;
    }
    alert("Assinatura criada com sucesso")
});

var build_customer = function() {
  var customer_params = {
      fullname: $("#fullname").val(),
      email: $("#email").val(),
      code: new Date().getTime(),
      cpf : $("#cpf").val(),
      birthdate_day : $("#birthdate_day").val(),
      birthdate_month: $("#birthdate_month").val(),
      birthdate_year: $("#birthdate_year").val(),
      phone_area_code: $("#ddd").val(),
      phone_number: $("#phone").val(),
      billing_info: build_billing_info(),
      address: build_address()
  }
  return new Customer(customer_params);
};

var build_billing_info = function() {
  var billing_info_params = {
      fullname : $("#holder_name").val(), 
      expiration_month: $("#expiration_month").val(),
      expiration_year: $("#expiration_year").val(),
      credit_card_number: $("#credit_card").val()
  };
  return new BillingInfo(billing_info_params);
};

var build_address = function() {
  var address_params = {
      street: $("#rua").val(),
      number: $("#numero").val(),
      complement: $("#complemento").val(),
      district: $("#bairro").val(),
      zipcode: $("#cep").val(),
      city: $("#cidade").val(),
      state: $("#estado").val(),
      country: "BRA"
  };
  return new Address(address_params);
};</pre>
                                <blockquote>
                                    <small>
                                     Veja detalhes de informações do cliente na documentação <a href="api.html#criar_cliente" target="_blank">API de cliente</a>
                                    </small>
                                </blockquote>

                            </div>
                        </div>
                    </section>


                    <!-- Criar um cliente
                    ================================================== -->
                    <div id="customer"></div>
                    <section>
                        <div class="page-header">
                            <h1>Criar um cliente com dados de cartão</h1>
                        </div>
                        <div>
                            <p>Para criar um cliente com dados de cartão sem relacioná-lo a uma assinatura, o processo é semelhante. Você cria um <code>new Customer()</code> e instância o objeto <code>new MoipAssinaturas('SEU_TOKEN')</code>, porém, você deverá chamar o método <code>MoipAssinaturas.create_customer()</code>. Nesse caso, apenas o cliente será criado e não estará associado a nenhuma assiantura.</p>
                            <h5>Exemplo</h5>
                            <div>
                                <pre class="prettyprint linenums">
var token = "MEU_TOKEN";
var customer = new Customer(); // Especifique todos os atributos de um Customer
moip = new MoipAssinaturas(token);
moip.create_customer(customer)
.callback(function(response){
  if (response.has_errors()) {
    for (i = 0; i < response.errors.length; i++) {
      var erro = response.errors[i].description;
      $("#erros").append(erro);
    }
    return;
  } 
  alert("Cliente criado com sucesso");
});
                                </pre>
                            </div>
                        </div>
                    </section>


                    <!-- Atualizar dados de cartão
                    ================================================== -->
                    <div id="update"></div>
                    <section>
                        <div class="page-header">
                            <h1>Atualizar dados de cartão</h1>
                        </div>
                        <div>
                            <p>Para atualizar os dados de cartão de um cliente é necessário construir um objeto <code>Customer()</code> onde obrigatoriamente deve haver o código do cliente no qual você deseja atualizar os dados de cartão e a nova <code>BillingInfo()</code> com os novos dados de cobrança.</p>
                            <h5>Exemplo</h5>
                            <div>
                                <pre class="prettyprint linenums">
var token = "MEU_TOKEN";
var moip = new MoipAssinaturas(token);

var customer = new Customer();
customer.code = "cliente01"; // Código identificador do seu cliente
customer.billing_info = new BillingInfo(); // Especifique um novo cartão para fazer a cobrança

moip.update_credit_card(customer).callback(function(response){
    if (response.has_errors()) {
        for (i = 0; i < response.errors.length; i++) {
            var erro = response.errors[i].description;
            $("#erros").append(erro);
        }
    return;
});;</pre>
                            </div>

                        </div>
                    </section>



                    <!-- Callback
                    ================================================== -->
                    <div id="callback"></div>
                    <section>
                        <div class="page-header">
                            <h1>Callback</h1>
                        </div>
                        <div>
                            <p>Personalizando o retorno do Moip Assinaturas.</p>
                            <h4>Passando um método de callback</h4>
                            <p>Assim que o Moip Assinaturas concluir a sua requisição o metódo de <strong>callback</strong> 
                                é executado. Isto é útil para você dar sequência ao seu checkout ou mesmo exibir mensagens 
                                de erros para o cliente ao preencher o formulário de pagamento.</p>
                            <p>Para que possamos chamar seu metódo de callback, é necessário que você passe o bloco de função para o metódo callback.</p>
                            <h5>Exemplo</h5>                                
                            <div>
                                <pre class="prettyprint linenums">
var moip = new MoipAssinaturas("SEU_TOKEN");
moip.callback(function(response){
  // aqui você adiciona os seus comportamentos esperados
});</pre>
                            </div>

                            <h4>Processando a resposta</h4>
                            <p>O Moip Assinaturas irá chamar seu callback passando como parâmetro um objeto <code>Response()</code>. Ele contém uma lista de possíveis 
                                erros da integração ou de informações preenchidas pelo seu cliente no checkout. O <code>Response()</code> também possui uma lista de 
                                alertas que auxiliam você na sua integração.</p>
                            <h5>Exemplo</h5>                           
                            <pre class="prettyprint linenums">
{
    "code": "ass_homolog_72",
    "amount": "100",
    "next_invoice_date": {
        "day": "05",
        "month": "01",
        "year": "2013"
    },
    "status": "ACTIVE",
    "plan": {
        "name": "Plano de homologação",
        "code": "homolog1"
    },
    "customer": {
        "email": "fulano@homolog.com",
        "code": "homolog2",
        "fullname": "Fulano Homologador"
    },
    "<a data-toggle="tooltip" title="dados da primeira cobrança (se houver)" data-placement="right">invoice</a>": {
        "id": 134,
        "moip_id": "14000000",
        "amount": 110,
        "status": {
            "description": "Em análise",
            "code": 2
        }
    },
    "message": "Assinatura criada com Sucesso",
    "errors": [],
    "alerts": [
        {
            "code": "MA90",
            "description": "O nome do portador do cartão deve ter no máximo 45 caracteres. Os demais caracteres serão ignorados"
        }
    ]
}</pre>


                            <p>Para verificar se há erros ou alertas na resposta do Moip Assinaturas, basta chamar o metódos <code>has_errors()</code> 
                                ou <code>has_alerts()</code>.</p>                
                            <h5>Exemplo</h5>
                            <div>
                                <pre class="prettyprint linenums">
var moip = new MoipAssinaturas("SEU_TOKEN");
moip.callback(function(response){
  alert(response.has_errors());
  alert(response.has_alerts());
});</pre>
                            </div>

                        </div>
                    </section>

                </div>
            </div>

        </div>



        <!-- Footer
        ================================================== -->
        <footer>
            <div align="center">
                <p>Documentação <a href="http://site.moip.com.br/assinaturas" target="_blank">Moip Assinaturas</a>, um produto <a href="https://www.moip.com.br/" target="_blank">Moip Pagamentos S/A</a>.</p>
                <a href="ajuda.html">Ajuda</a>
                <strong class="muted"> | </strong>
                <a href="index.html#changelog">Changelog</a>
                <strong class="muted"> | </strong>
                <a href="english_version.html">English version</a>

            </div>
        </footer>

        <script src="javascript/jquery.js"></script>
        <script src="javascript/main.js"></script>
        <script src="javascript/prettify.js"></script>
        <script src="javascript/bootstrap-dropdown.js"></script>
        <script src="javascript/bootstrap-scrollspy.js"></script>
        <script src="javascript/bootstrap-tooltip.js"></script>
        <script src="javascript/bootstrap-popover.js"></script>

        <script src="javascript/bootstrap-modal.js"></script>

        <script>
            $(document).ready(function() {
                $('[data-toggle="tooltip"]').tooltip();
            });
        </script>
        <!-- Qualaroo for moip.com.br -->
        <!-- Paste this code right after the <body> tag on every page of your site. -->
        <script type="text/javascript">var _kiq = _kiq || [];</script>
        <script type="text/javascript" src="//s3.amazonaws.com/ki.js/23295/9ND.js" async="true"></script> 

    </body>
</html>
