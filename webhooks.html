
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Moip Assinaturas - Documentação online</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Exemplo de utilização do Javascript assinaturas.js">
        <meta name="author" content="Moip Assinaturas">

        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/demo.css" rel="stylesheet">
        <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="css/prettify.css" rel="stylesheet">

        <link rel="shortcut icon" href="img/favicon.ico">
        <style>
            section {
                padding-top: 30px;
            }          
        </style>
    </head>

    <body data-spy="scroll" data-target="#navbar" data-offset="10">
        <div class="navbar navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand active" href="index.html">Assinaturas Docs</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav" role="navigation">
                            <li><a href="index.html">Introdução</a></li>                           
                            <li><a href="comece.html">Comece a integrar</a></li>                           
                            <li class="dropdown active">
                                <a class="dropdown-toggle" id="dLabel" role="button" data-toggle="dropdown" data-target="#" href="api.html">
                                    Documentação
                                    <b class="caret"></b>
                                </a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="api.html">APIs</a></li>
                                    <li><a href="js.html">moip-assinaturas.js</a></li>              
                                    <li class="divider"></li>
                                    <li class="nav-header">Adicionais</li>
                                    <li class="active"><a href="webhooks.html">Webhooks</a></li>
                                    <li><a href="erros_alertas.html">Erros e Alertas</a></li>              
                                </ul>
                            </li>   
                            <li><a href="producao.html">Homologação</a></li>              
                            <li><a href="ajuda.html">Ajuda</a></li>              
                            <li><a href="english_version.html">English version</a></li>
                        </ul>
                        <a href="http://assinaturas.moip.com.br" class="btn pull-right">Login</a>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>


        <div class="container">

            <!-- Docs nav
            ================================================== -->
            <div class="row">
                <div class="span3 bs-docs-sidebar" id="navbar">
                    <ul class="nav nav-list bs-docs-sidenav affix">
                        <li><a href="#geral"><i class="icon-chevron-right"></i>Webhooks</a></li>
                        <li><a href="#plano"><i class="icon-chevron-right"></i> Plano</a></li>
                        <li><a href="#cliente"><i class="icon-chevron-right"></i> Cliente</a></li>
                        <li><a href="#assinatura"><i class="icon-chevron-right"></i> Assinatura</a></li>
                        <li><a href="#fatura"><i class="icon-chevron-right"></i> Fatura</a></li>
                        <li><a href="#pagamento"><i class="icon-chevron-right"></i> Pagamento</a></li>   
                        <li><a href="#simulacao"><i class="icon-chevron-right"></i> Simulação</a></li> 
                    </ul>
                </div>
                <div class="span9" style="margin-top: -40px;">


                    <!-- Visão Geral
                    ================================================== -->
                    <div id="geral"></div>
                    <section>
                        <div class="page-header">
                            <h1>Webhooks</h1>
                        </div>
                        <div>
                            <p>O Moip Assinaturas utiliza <a href="http://en.wikipedia.org/wiki/Webhook" target="_blank">webhooks</a> para notificar a sua aplicação em tempo real sobre os eventos que afetam os 
                                recursos da sua conta, como clientes, assinaturas, faturas e pagamentos.</p>

                            <h4>URL de notificação</h4><p>Para começar a receber os eventos por webhooks, você deve primeiro configurar uma URL para qual você deseja que as notificações sejam enviadas.
                                Você pode fazer isso de duas maneiras. A primeira é acessando a área logada do Moip assinaturas, selecionar o menu configurações e cadastrar.</p>
                            <p>A segunda maneira é por meio de uma API. Para isso você precisa fazer a seguinte requisição:</p>
                            <div class="input-prepend">
                                <span class="add-on">POST</span>
                                <input class="span8" id="prependedInput" type="text" value="https://sandbox.moip.com.br/assinaturas/v1/users/preferences">
                            </div>
                            <pre class="prettyprint linenums">{
    "notification": {
        "webhook": {
            "url": "http://exemploldeurl.com.br/assinaturas"
        }
    }
}</pre>
                            <p><i><small><strong>Importante:</strong>  a URL de notificação para assinaturas deve ser configurada no Moip Assinaturas, sendo assim possível configurar uma URL diferente da cadastrada na sua Conta Moip.</small></i></p>
                            <h4>Token de notificação</h4>
                            Para garantir que as notificações têm como origem o Moip Assinaturas, verifique no header da requisição se o parâmetro <code>Authorization</code> possui o token de autenticação, que pode ser consultado na seção <i>"Configurações"</i> da área logada do Moip Assinaturas:</p>
                            <h4>Eventos notificados</h4>
                            <p>Atualmente as notificações contemplam os seguintes eventos:</p>
                            <div>
                                <ul>
                                    <li><strong>Plano:</strong>
                                        <ul>
                                            <li><a href="#plano_criado">criado ou atualizado</a></li>
                                            <li><a href="#plano_habilitar">ativo ou inativo</a></li>
                                        </ul>
                                    </li>
                                    <li><strong>Cliente:</strong>
                                        <ul>
                                            <li><a href="#cliente_criado">criado ou atualizado</a></li>
                                        </ul>
                                    </li>
                                    <li><strong>Assinatura:</strong>
                                        <ul>
                                            <li><a href="#assinatura_criada">criada ou atualizada</a></li>
                                            <li><a href="#assinatura_suspensa">suspensa ou ativa</a></li>
                                            <li><a href="#assinatura_cancelada">assinatura cancelada</a></li>
                                        </ul>
                                    </li>
                                    <li><strong>Fatura:</strong>
                                        <ul>
                                            <li><a href="#fatura_criado">criada</a></li>
                                            <li><a href="#fatura_atualizada">alteração no status da fatura</a></li>
                                        </ul>
                                    </li>
                                    <li><strong>Pagamento:</strong>
                                        <ul>
                                            <li><a href="#pagamento_criado">criado</a></li>
                                            <li><a href="#pagamento_atualizado">alteração no status do pagamento</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h4>Estrutura da requisição</h4>
                                <p>O formato da requisição HTTP enviada pelo Moip Assinaturas será sempre a mesma, variando apenas o node <code>resource</code>:</p>
                                <pre class="prettyprint">Method: POST
Authorization: <a href="#">Token de notificação</a>
Content-Type: application/json</pre>
                                <pre class="prettyprint linenums">{
   "event": "plan.created", //tipo de evento
   "date": "01/01/2013 00:00:00", //data da notificação
   "env": "sandbox", //ambiente a partir do qual foi enviada a notificação.
   "resource": { //objeto notificado (variável de acordo com o evento)
       ...
   }
}</pre>
                                <i><small><strong>Importante:</strong> o ambiente pode ser <code>sandbox</code> para o ambiente de testes ou <code>prod</code> para produção.</small></i>
                            </div>
                        </div>
                    </section>



                    <!-- Plano
                    ================================================== -->
                    <div id="plano"></div>
                    <section>
                        <div class="page-header">
                            <h1>Planos</h1>
                        </div>
                        <div>
                            <p>Para planos, o sistema do assinaturas envia 4 tipos de eventos: <code>created</code>, <code>updated</code>, <code>activated</code> e <code>inactivated</code>. Para created e updated será notificado o objeto completo.</p>
                            <h4 id="plano_criado">Criado e Atualizado <small><code>plan.created</code> e <code>plan.updated</code></small></h4>
                            <p>A criação e atualização de plano terá notificação do objeto completo, assim, será possível criar um plano em seu sistema com os mesmos atributos criados no Moip Assinaturas.</p>
                            <pre class="prettyprint linenums">{
    "event": "plan.created",
    "resource": {
        "amount": 990,
        "max_qty": 1,
        "setup_fee": 500,
        "interval": {
            "unit": "MONTH",
            "length": 1
        },
        "status": "ACTIVE",
        "description": "Descrição do Plano Especial",
        "name": "Plano Especial",
        "billing_cycles": 12,
        "code": "plano01",
        "trial": {
            "enabled": true,
            "days": 30
        }
    },
    "env": "sandbox",
    "date": "01/01/2013 00:00:00"
}</pre>

                            <h4 id="plano_habilitar">Habilitado e Desabilitado <small><code>plan.activated</code> e <code>plan.inactivated</code></small></h4>
                            <p>Nestes dois eventos será notificado apenas o código de identificação da sua aplicação.</p>
                            <pre class="prettyprint linenums">{
   "event": "plan.activated", 
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": { 
        "code": "plano01"
   }
}</pre>
                        </div>
                    </section>



                    <!-- Cliente
                    ================================================== -->
                    <div id="cliente"></div>
                    <section>
                        <div class="page-header">
                            <h1>Cliente</h1>
                        </div>
                        <div>
                            <p>O Moip Assinaturas envia dois tipos de eventos: <code>created</code> e <code>updated</code>.<br>
                                O node <code>billing_info.credit_cards</code> sempre será enviado, mas vai estar vazio caso o cliente não não possuia informações de cartão de crédito ainda.</p>
                            <h4 id="cliente_criado">Criado e Atualizado <small><code>customer.created</code> e <code>customer.updated</code></small></h4>
                            <p>A criação e atualização do cliente tem notificação do objeto completo, assim, é possível criar ou atualizar um cliente em seu sistema com os mesmos atributos criados no Moip Assinaturas.</p>
                            <pre class="prettyprint linenums">{
   "event": "customer.created", 
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": { 
        "code": "cliente01",
        "fullname": "Nome completo do Cliente",
        "cpf": "11111111111",
        "birthdate_day": 11,
        "birthdate_month": 10,
        "birthdate_year": 1986
        "email": "teste@teste.com",
        "phone_area_code": "11",
        "phone_number": "111111111",
        "address": {
            "street": "Rua Teste",
            "number": "1",
            "complement": "apto 1",
            "district": "Teste",
            "zipcode": "11111111",
            "city": "São Paulo",
            "state": "São Paulo",
            "country": "BRA"
        },
        "billing_info": { // estará vazio se o cliente não possuir dados de cobrança.
            "credit_cards": [{
                    "vault": "teste-teste00-1teste-t35t3-135879",
                    "holder_name": "Nome do portador no cartao",
                    "first_six_digits": "411111",
                    "last_four_digits": "1111"
                    "expiration_month": "09",
                    "expiration_year": "16",
                    "brand": "VISA"
                }]
        }
   }
}</pre>


                        </div>
                    </section>


                    <!-- Assinatura
                    ================================================== -->
                    <div id="assinatura"></div>
                    <section>
                        <div class="page-header">
                            <h1>Assinatura</h1>
                        </div>
                        <div>
                            <p>O Moip Assinaturas envia cinco tipos de eventos: <code>created</code>, <code>updated</code>, <code>suspended</code>, <code>activated</code> e <code>canceled</code>.</p> 
                            <p>No processo de criação de uma assinatura, o sistema do Moip cria um pagamento <span class="label label-inverse">payment</span>, uma fatura <span class="label label-inverse">invoice</span> e por fim, a própria assinatura <span class="label label-inverse">subscription</span>. A sua aplicação deve receber webhook para cada um desses eventos nesta ordem.
                                Caso seja apenas uma atualização de uma assinaturas, você deve esperar receber apenas a notificação da assinaturas.</p>
                            <h4 id="assinatura_criada">Criada <small><code>subscription.created</code></small></h4>
                            <p>A criação da assinatura tem a notificação do objeto completo. Antes da notificação da assinatura, são enviadas as notificações de fatura e pagamento.</p>
                            <pre class="prettyprint linenums">{
    "event": "subscription.created",
    "resource": {
        "amount": 990,
        "creation_date": {
            "month": 01,
            "year": 2013,
            "day": 01
        },
        "plan": {
            "code": "plano01"
        },
        "status": "ACTIVE",
        "expiration_date": {
            "month": 06,
            "year": 2013,
            "day": 01
        },
        "next_invoice_date": {
            "month": 02,
            "year": 2013,
            "day": 01
        },
        "code": "assinatura01",
        "customer": {
            "code": "cliente01"
        }
    },
    "env": "sandbox",
    "date": "01/01/2013 00:00:00"
}
}</pre>
                            <h4>Atualizada <small><code>subscription.updated</code></small></h4>
                            <p>A atualização de assinatura tem notificação do objeto completo.</p>
                            <pre class="prettyprint linenums">{
    "event": "subscription.updated",
    "resource": {
        "amount": 15000,
        "creation_date": {
            "month": 01,
            "year": 2013,
            "day": 01
        },
        "plan": {
            "code": "plano01"
        },
        "status": "ACTIVE",
        "expiration_date": {
            "month": 06,
            "year": 2013,
            "day": 01
        },
        "next_invoice_date": {
            "month": 02,
            "year": 2013,
            "day": 01
        },
        "code": "assinatura01",
        "customer": {
            "code": "cliente01"
        }
    },
    "env": "sandbox",
    "date": "01/01/2013 00:00:00"
}
}</pre>
                            <h4 id="assinatura_suspensa">Suspensa e Ativa <small><code>subscription.suspended</code> e <code>subscription.activated</code></small></h4>
                            <p>Para <code>suspended</code> e <code>activated</code>, é notificado apenas o código de identificação da sua aplicação.</p>
                            <pre class="prettyprint linenums">{
    "event": "subscription.suspended",
    "resource": {
        "code": "assinatura01"
    },
    "env": "prod",
    "date": "01/01/2013 00:00:00"
}</pre>

                            <h4 id="assinatura_cancelada">Cancelada <small><code>subscription.canceled</code></small></h4>
                            <p>Esse webhook notifica o cancelamento de uma assinatura.</p>
                            <pre class="prettyprint linenums">{
    "event": "subscription.canceled",
    "resource": {
        "code": "assinatura01"
    },
    "env": "sandbox",
    "date": "01/01/2013 00:00:00"
}</pre>
                        </div>
                    </section>


                    <!-- Fatura
                    ================================================== -->
                    <div id="fatura"></div>
                    <section>
                        <div class="page-header">
                            <h1>Fatura</h1>
                        </div>
                        <div>
                            <h4 id="fatura_criada">Criada <small><code>invoice.created</code></small></h4>
                            <pre class="prettyprint linenums">{
   "event": "invoice.created",
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": {
       "id": 13, //ID da fatura
       "subscription_code": "assinatura01",
       "amount": 101,
       "occurrence": 1,
       "status": {
           "code": 1,
           "description": "Em aberto"
       }
   }
}</pre>
                            <h4 id="fatura_atualizada">Atualizada <small><code>invoice.status_updated</code></small></h4>
                            <pre class="prettyprint linenums">{
   "event": "invoice.status_updated",
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": {
       "id": 13, //ID da fatura
       "status": { //novo status da fatura
           "code": 2,
           "description": "Aguardando confirmação"
       }
   }
}</pre>
                        </div>

                        <hr>
                        <div>
                            <h3>Reenvio de notificação de fatura</h3>
                            <p>Você pode solicitar o reenvio de uma notificação de 
                                <code>invoice.created</code> via API. Para isso, basta enviar ao Moip Assinaturas uma requisição conforme mostrado abaixo.</p>
                            <h4>Requisição</h4>
                            <div class="input-prepend">
                                <span class="add-on">POST</span> <input class="span8"
                                                                        id="prependedInput" type="text"
                                                                        value="https://sandbox.moip.com.br/assinaturas/v1/invoices/{id}/notify" />
                            </div>
                            <pre class="prettyprint">
Request Method: POST
Authorization: Basic TOKEN:KEY
Content-Type: application/json
Accept: application/json</pre>
                        </div>
                    </section>


                    <!-- Pagamento
                    ================================================== -->
                    <div id="pagamento"></div>
                    <section>
                        <div class="page-header">
                            <h1>Pagamento</h1>
                        </div>
                        <div>
                            <p>Sempre que um pagamento for gerado, o Moip Assinaturas envia o objeto de Pagamento completo. Se o pagamento ter o status atualizado, é enviado apenas o novo status.</p>
                            <h4 id="pagamento_criado">Criado <small><code>payment.created</code></small></h4>
                            <pre class="prettyprint linenums">{
   "event": "payment.created",
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": {
       "id": 6, //ID do pagamento
       "invoice_id": 13,
       "moip_id": 14456223,
       "subscription_code": "assinatura01",
       "amount": 101,
       "status": {
           "code": 2,
           "description": "Iniciado"
       },
       "payment_method": {
           "code": 1,
           "description": "Cartão de Crédito",
           "credit_card": { //enviado apenas se foi pago com cartão de crédito
               "brand": "VISA",
               "holder_name": "Fulano Testador",
               "first_six_digits": "411111",
               "last_four_digits": "1111",
               "vault": "cc7719e7-9543-4380-bdfe-c14d0e3b8ec9"
           }
       }
   }
}</pre>
                            <h4 id="pagamento_atualizado">Status atualizado  <small><code>payment.status_updated</code></small></h4>
                            <pre class="prettyprint linenums">{
   "event": "payment.status_updated",
   "date": "01/01/2013 00:00:00",
   "env": "sandbox",
   "resource": {
       "id": 6, //identificador do pagamento
       "status": { //novo status do pagamento
           "code": 6,
           "description": "Em análise"
       }
   }
}</pre>
                        </div>
                        <hr />
                        <div>
                            <h3>Reenvio de notificação de pagamento</h3>
                            <p>Você pode reenviar uma notificação de <code>payment.created</code> via API, basta enviar ao Moip 
                                Assinaturas uma requisição conforme mostrado abaixo.</p>
                            <h4>Requisição</h4>
                            <div class="input-prepend">
                                <span class="add-on">POST</span> <input class="span8"
                                                                        id="prependedInput" type="text"
                                                                        value="https://sandbox.moip.com.br/assinaturas/v1/payments/{id}/notify" />
                            </div>
                            <pre class="prettyprint">
Request Method: POST
Authorization: Basic TOKEN:KEY
Content-Type: application/json
Accept: application/json</pre>

                        </div>
                    </section>


                    <!-- Simulacao
                    ================================================== -->
                    <div id="simulacao"></div>
                    <section>
                        <div class="page-header">
                            <h1>Simulando status de pagamento</h1>
                        </div>
                        <div>
                            <p>O Simulador do Moip Assinaturas permite que você faça testes de envio e retorno de pagamentos no ambiente de testes (Sandbox).</p>

                            <h4>Como usar o simulador</h4>
                            <p>Na criação da assinatura, envie no atributo <code>customer.fullname</code> o valor relacionado ao status que você deseja receber na simulação da cobrança.</p>
                            <h5>Status de pagamento que podem ser simulados</h5>
                            <table class="table table-bordered table-striped table-condensed">
                                <thead>
                                    <tr>
                                        <th class="span2">Valor no atributo <code>customer.fullname</code> </th>
                                        <th class="span4">Status do pagamento simulado</th>
                                    </tr>
                                </thead>                            
                                <tbody>
                                    <tr>
                                        <td><code>Autorizar</code></td>
                                        <td>Autorizado</td>
                                    </tr>

                                    <tr>
                                        <td><code>Cancelar</code></td>
                                        <td>Cancelado</td>
                                    </tr>
                                    <tr>
                                        <td><code>EmAnalise</code></td>
                                        <td>Pré-autorizado</td>
                                    </tr>
                                </tbody>
                            </table>



                            <h5>Simulando pela API <small>exemplo de requisição</small></h5>                                
                            <div class="input-prepend">
                                <span class="add-on">POST</span>
                                <input class="span8" id="prependedInput" type="text" value="http://sandbox.moip.com.br/assinaturas/v1/subscriptions?new_customer=true">
                            </div>
                            <pre class="prettyprint linenums">{
  "code": "assinatura01",
  "plan": {
      "code": "plano01"
  },
  "customer": {
      "code": "cliente01",
      "email": "fulano@teste.com.br",
      "fullname": " Autorizar",  //altere o valor para utilizar o simulador
      "cpf": "22222222222",
      "phone_number": "55223366",
      "phone_area_code": "11",
      "birthdate_day": "26",
      "birthdate_month": "04",
      "birthdate_year": "1986",
      "address": {
      },
      "billing_info": {
      }
  }
}</pre>

                            <h5>Simulando pela área logada</h5>                                
                            <p>Para utilizar o simulador a partir da área logada do Moip Assinaturas, cadastre um cliente com o nome de acordo com o status que deseja testar e crie uma assinatura para ele.</p>
                        </div>
                    </section>

                </div>
            </div>

        </div>



        <!-- Footer
        ================================================== -->
        <footer>
            <div align="center">
                <p>Documentação <a href="http://site.moip.com.br/assinaturas" target="_blank">Moip Assinaturas</a>, um produto <a href="https://www.moip.com.br/" target="_blank">Moip Pagamentos S/A</a>.</p>
                <a href="ajuda.html">Ajuda</a>
                <strong class="muted"> | </strong>
                <a href="index.html#changelog">Changelog</a>
                <strong class="muted"> | </strong>
                <a href="english_version.html">English version</a>

            </div>
        </footer>

        <script src="javascript/jquery.js"></script>
        <script src="javascript/prettify.js"></script>
        <script src="javascript/main.js"></script>
        <script src="javascript/bootstrap-dropdown.js"></script>
        <script src="javascript/bootstrap-scrollspy.js"></script>
        <!-- Qualaroo for moip.com.br -->
        <!-- Paste this code right after the <body> tag on every page of your site. -->
        <script type="text/javascript">var _kiq = _kiq || [];</script>
        <script type="text/javascript" src="//s3.amazonaws.com/ki.js/23295/9ND.js" async="true"></script> 
    </body>
</html>